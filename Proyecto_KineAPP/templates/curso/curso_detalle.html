{% load static %}
<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>{{ curso.nombre }} ‚Äì Plataforma Kinesiolog√≠a UCN</title>

  <link rel="stylesheet" href="{% static 'css/panel.css' %}">

  <style>
    body {
      background: #f4f8ff;
      margin: 0;
      font-family: "Inter", "Roboto", system-ui;
    }

    .layout-estudiante {
      display: flex;
      min-height: calc(100vh - 72px);
      padding: 20px;
      gap: 24px;
      width: 100%;
      box-sizing: border-box;
    }

    /* Sidebar del curso */
    .sidebar {
      width: 260px;
      background: #004b8d;
      padding: 22px 18px 26px;
      border-radius: 16px;
      color: #ffffff;
      height: fit-content;
      box-shadow: 0 6px 20px rgba(0,0,0,0.15);
      display: flex;
      flex-direction: column;
      gap: 16px;
    }

    .sidebar__title {
      font-size: 1.1rem;
      font-weight: 600;
    }

    .sidebar__nav--curso {
      display: flex;
      flex-direction: column;
      gap: 10px;
    }

    .sidebar__item {
      background: rgba(255,255,255,0.20);
      color: #ffffff;
      font-size: 0.95rem;
      border: none;
      padding: 12px 14px;
      border-radius: 12px;
      cursor: pointer;
      text-align: left;
      transition: 0.2s;
      width: 100%;
    }

    .sidebar__item:hover {
      background: rgba(255,255,255,0.32);
    }

    .sidebar__item.is-active {
      background: #ffffff;
      color: #004b8d;
      font-weight: 600;
    }

    /* Bot√≥n volver a cursos dentro del sidebar */
    .btn-volver-cursos {
      display: block;
      width: 100%;
      text-align: center;
      margin-top: 8px;
      padding: 10px 14px;
      border-radius: 999px;
      background: #ffffff;
      color: #004b8d;
      font-size: 0.9rem;
      font-weight: 600;
      text-decoration: none;
      box-shadow: 0 4px 14px rgba(0,0,0,0.18);
      transition: background 0.2s, color 0.2s, transform 0.1s, box-shadow 0.2s;
    }

    .btn-volver-cursos:hover {
      background: #e6f2ff;
      transform: translateY(-1px);
      box-shadow: 0 6px 18px rgba(0,0,0,0.22);
    }

    .main-wrapper {
      flex: 1;
      padding: 0 20px 40px 0;
      display: flex;
      flex-direction: column;
      gap: 20px;
    }

    /* Tarjeta superior del curso */
    .curso-card {
      background: #ffffff;
      border-radius: 18px;
      box-shadow: 0 8px 24px rgba(0,0,0,0.08);
      padding: 20px 24px;
      display: flex;
      justify-content: space-between;
      gap: 20px;
    }

    .curso-card__title {
      font-size: 1.4rem;
      font-weight: 700;
      margin-bottom: 4px;
      color: #003c71;
    }

    .curso-card__badge {
      display: inline-block;
      padding: 3px 10px;
      border-radius: 999px;
      background: #e6f2ff;
      color: #005aa7;
      font-weight: 600;
      font-size: 0.8rem;
    }

    .curso-card__meta {
      font-size: 0.9rem;
      color: #4d4d4d;
      line-height: 1.4;
      text-align: right;
    }

    /* Secciones */
    .curso-section {
      display: none;
      background: #ffffff;
      padding: 24px 28px;
      border-radius: 18px;
      box-shadow: 0 8px 24px rgba(0,0,0,0.08);
    }

    .curso-section.is-active {
      display: block;
    }

    .curso-section h2 {
      font-size: 1.3rem;
      margin-bottom: 12px;
      color: #003c71;
    }

    .indice-tema {
      margin-bottom: 18px;
      padding-bottom: 12px;
      border-bottom: 1px solid #ececec;
    }

    .indice-tema h3 {
      font-size: 1.1rem;
      margin-bottom: 6px;
      color: #003c71;
    }

    .indice-tema ul { padding-left: 20px; }

    .indice-tema a {
      text-decoration: none;
      color: #005aa7;
      font-weight: 500;
    }

    .indice-tema a:hover { text-decoration: underline; }

    /* Barra inferior links UCN */
    .links-interes {
      margin-top: 40px;
      display: flex;
      justify-content: center;
    }

    .link-box {
      width: 90%;
      background: #004b8d;
      padding: 20px;
      color: #ffffff;
      border-radius: 16px;
      text-align: center;
      box-shadow: 0 8px 24px rgba(0,0,0,0.15);
    }

    .link-box img {
      width: 80px;
      margin-bottom: 8px;
    }
  </style>
</head>

<body>

  <!-- HEADER -->
  <header class="header">
    <div class="header__inner">

      <a href="#" class="logo">
        <div class="logo__mark">K</div>
        <div class="logo__text">
          <span class="logo__title">Kinesiolog√≠a UCN</span>
          <span class="logo__subtitle">Plataforma de Simulaci√≥n</span>
        </div>
      </a>

      <div class="search">
        <div class="search__box">
          <input class="search__input" type="search" placeholder="Buscar cursos, temas o pacientes..." />
        </div>
      </div>

      <div class="header__actions">
        <button id="btnNotificaciones" class="icon-btn">
          <span id="badgeCount" class="badge">1</span>
        </button>

        {% with persona=perfil|default:user %}
        <a href="{% url 'usuario:perfil' %}" style="text-decoration: none;">
          <div class="avatar">
            {% if persona.first_name and persona.last_name %}
              {{ persona.first_name|slice:":1" }}{{ persona.last_name|slice:":1" }}
            {% else %}
              {{ persona.username|slice:":2"|upper }}
            {% endif %}
          </div>
        </a>
        {% endwith %}

        <a href="{% url 'usuario:logout' %}" class="logout-link">Cerrar sesi√≥n</a>
      </div>

    </div>
  </header>

  <div class="layout-estudiante">

    <!-- SIDEBAR DEL CURSO -->
    <aside class="sidebar">
      <div class="sidebar__title">Men√∫</div>

      <nav class="sidebar__nav sidebar__nav--curso">
        <button class="sidebar__item is-active" data-section="presentacion">Presentaci√≥n del m√≥dulo</button>
        <button class="sidebar__item" data-section="indice">√çndice de contenidos del m√≥dulo</button>
        <button class="sidebar__item" data-section="sala">Sala de espera ‚Äì Pacientes simulados</button>
        <button class="sidebar__item" data-section="material">Material adicional ‚Äì Etapas cl√≠nicas</button>
      </nav>

      <!-- Bot√≥n VOLVER A CURSOS en la parte de abajo del sidebar -->
      <a href="{% url 'usuario:panel_estudiante' %}" class="btn-volver-cursos">
        Volver a cursos
      </a>
    </aside>

    <!-- CONTENIDO -->
    <div class="main-wrapper">

      <!-- Tarjeta superior -->
      <div class="curso-card">
        <div>
          <h1 class="curso-card__title">{{ curso.nombre }}</h1>
          <span class="curso-card__badge">{{ curso.get_nivel_display }}</span>
        </div>

        <div class="curso-card__meta">
          <p><strong>Docentes:</strong>
            {% for d in curso.docentes.all %}
              {{ d.first_name }} {{ d.last_name }}{% if not forloop.last %}, {% endif %}
            {% empty %} Sin docentes asignados {% endfor %}
          </p>
        </div>
      </div>

      <!-- PRESENTACI√ìN -->
      <section id="presentacion" class="curso-section is-active">
        <h2>Presentaci√≥n del m√≥dulo</h2>
        <p>
          {% if curso.descripcion %}
            {{ curso.descripcion }}
          {% else %}
            Este m√≥dulo no tiene una descripci√≥n cargada a√∫n.
          {% endif %}
        </p>
      </section>

      <!-- √çNDICE -->
      <section id="indice" class="curso-section">
        <h2>√çndice de contenidos del m√≥dulo</h2>

        {% if indice %}
          {% for tema, videos in indice.items %}
            <div class="indice-tema">
              <h3>{{ tema.titulo }}</h3>

              {% if videos %}
                <ul>
                  {% for video in videos %}
                  <li>
                    <a href="{% url 'Contenido:preguntas_del_video' video.id %}">
                      üé¨ {{ video.titulo }}
                    </a>
                  </li>
                  {% endfor %}
                </ul>
              {% else %}
                <p>No hay videos asignados para este tema.</p>
              {% endif %}
            </div>
          {% endfor %}
        {% else %}
          <p>No tienes contenidos asignados para este curso.</p>
        {% endif %}
      </section>

      <!-- SALA DE ESPERA -->
      <section id="sala" class="curso-section">
        <h2>Sala de espera ‚Äì Pacientes simulados</h2>

        {% if seleccion %}
          <p>
            <strong>Paciente seleccionado actualmente:</strong><br>
            {{ seleccion.paciente.apellidos }}, {{ seleccion.paciente.nombres }}
            ({{ seleccion.paciente.edad }} a√±os)
          </p>
        {% else %}
          <p>No has seleccionado un paciente a√∫n.</p>
        {% endif %}

        <h3>Seleccionar paciente</h3>

        {% if pacientes %}
          <ul>
            {% for p in pacientes %}
              <li>
                {{ p.apellidos }}, {{ p.nombres }} ({{ p.edad }} a√±os)
                <a href="{% url 'curso:seleccionar_paciente_curso' curso.id p.id %}">
                  Seleccionar
                </a>
              </li>
            {% endfor %}
          </ul>
        {% else %}
          <p>No hay pacientes disponibles.</p>
        {% endif %}
      </section>

      <!-- MATERIAL ADICIONAL -->
      <section id="material" class="curso-section">
        <h2>Material adicional ‚Äì Etapas cl√≠nicas</h2>
        <p>Contenido complementario para el estudiante.</p>
        <!-- Aqu√≠ ya NO va el bot√≥n -->
      </section>

      <!-- BARRA UCN -->
      <div class="links-interes">
        <div class="link-box">
          <img src="{% static 'img/ucn_logo2.png' %}" alt="UCN">
          Universidad Cat√≥lica del Norte ‚Äì Facultad de Medicina
        </div>
      </div>

    </div>
  </div>

  <!-- JS: cambia entre secciones -->
  <script>
    const buttons = document.querySelectorAll(".sidebar__item");
    const sections = document.querySelectorAll(".curso-section");

    buttons.forEach(btn => {
      btn.addEventListener("click", () => {
        buttons.forEach(b => b.classList.remove("is-active"));
        btn.classList.add("is-active");

        const target = btn.dataset.section;

        sections.forEach(sec => {
          sec.classList.remove("is-active");
          if (sec.id === target) {
            sec.classList.add("is-active");
          }
        });
      });
    });
  </script>

</body>
</html>
