{% load static %}
<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{{ curso.nombre }} ‚Äî Plataforma Kinesiolog√≠a UCN</title>

    <!-- CSS -->
    <link rel="stylesheet" href="{% static 'css/curso_detalle.css' %}">
</head>

<body>

    <div class="layout">
        <div class="content__inner" id="section-content">

            <!-- COVER DEL CURSO -->
            <div class="module-cover">
                <div class="frame" aria-label="Imagen de portada del curso">
                    [Imagen Cover M√≥dulo {{ curso.nombre }}]
                </div>
            </div>

            <!-- CABECERA DEL CURSO -->
            <div class="module-head">

                <div>
                    <h1 class="module-head__title">{{ curso.nombre }}</h1>
                    <span class="pill">Nivel: {{ curso.get_nivel_display }}</span>
                </div>

                <div class="module-head__meta">
                    <span>
                        <strong>Fecha inicio:</strong>
                        {{ curso.fecha_inicio|default_if_none:"No definida" }}
                    </span>
                    <span>
                        <strong>Fecha fin:</strong>
                        {{ curso.fecha_fin|default_if_none:"No definida" }}
                    </span>
                    <span>
                        <strong>Temas:</strong> {{ temas|length }}
                    </span>
                    <span>
                        <strong>Pacientes de ejemplo:</strong> {{ pacientes|length }}
                    </span>
                </div>

            </div>

            <!-- SECCI√ìN: PRESENTACI√ìN -->
            <div class="content-section show" data-section="presentacion">
                <h2>Presentaci√≥n del m√≥dulo</h2>
                <p>
                    Bienvenido al curso <strong>{{ curso.nombre }}</strong>. Aqu√≠ podr√°s revisar los temas,
                    casos cl√≠nicos, pacientes y contenidos adicionales del m√≥dulo.
                </p>

                <div class="img-frame">[Imagen presentaci√≥n]</div>
            </div>

            <!-- SECCI√ìN: √çNDICE DE CONTENIDOS -->
            <div class="content-section" data-section="indice">
                <h2>√çndice de contenidos del m√≥dulo</h2>

                {% if temas %}
                    {% for tema in temas %}
                        <div class="tema-block">

                            <div class="tema-title">{{ tema.titulo }}</div>

                            {% if tema.descripcion %}
                                <p>{{ tema.descripcion }}</p>
                            {% endif %}

                            <ul class="video-list">
                                {% for video in tema.video_set.all %}
                                    <li>
                                        {{ video.titulo }}

                                        {% if video.preguntas.all %}
                                            <ul class="question-list">
                                                {% for pregunta in video.preguntas.all %}
                                                    <li>
                                                        Pregunta: {{ pregunta.contenido|truncatechars:80 }}
                                                    </li>
                                                {% endfor %}
                                            </ul>
                                        {% endif %}
                                    </li>
                                {% endfor %}
                            </ul>

                        </div>
                    {% endfor %}
                {% else %}
                    <p>No hay temas asociados a este curso.</p>
                {% endif %}
            </div>

            <!-- SECCI√ìN: PACIENTES -->
            <div class="content-section" data-section="pacientes">

                <h2>Sala de espera ‚Äî Pacientes simulados</h2>

                {% if seleccion %}
                    <p>Paciente seleccionado: <strong>{{ seleccion.paciente }}</strong></p>
                {% endif %}

                {% if pacientes %}
                    <div class="avatars">

                        {% for pac in pacientes %}
                            <div class="avatar-card 
                                {% if seleccion and seleccion.paciente.id == pac.id %}
                                    avatar-card--selected
                                {% endif %}
                            ">

                                <div class="avatar-placeholder">üßç</div>

                                <strong>{{ pac.nombres }}, {{ pac.apellidos }}</strong>
                                <small>Edad: {{ pac.edad }} a√±os</small>
                                <small>
                                    Antecedentes:
                                    {{ pac.antecedentes|truncatechars:80 }}
                                </small>

                                <div class="avatar-actions">
                                    <a class="btn btn--ghost"
                                       href="{% url 'curso_y_modulo:seleccionar_paciente_curso' curso.id pac.id %}">
                                        Usar este paciente
                                    </a>
                                </div>

                            </div>
                        {% endfor %}

                    </div>
                {% else %}
                    <p>Este curso no tiene pacientes vinculados.</p>
                {% endif %}

            </div>

            <!-- SECCI√ìN: CONTENIDOS ADICIONALES -->
            <div class="content-section" data-section="contenidos">
                <h2>Material adicional y etapas cl√≠nicas</h2>

                {% if etapas %}
                    <ul class="etapa-list">

                        {% for etapa in etapas %}
                            <li class="etapa-item">

                                <div class="etapa-title">
                                    {{ etapa.caso.titulo }} ‚Äî Etapa {{ etapa.orden }}: {{ etapa.nombre }}
                                </div>

                                {% if etapa.parte_cuerpo %}
                                    <small>Parte del cuerpo: {{ etapa.parte_cuerpo.nombre }}</small><br>
                                {% endif %}

                                {% if etapa.pregunta %}
                                    <small>Pregunta gu√≠a: {{ etapa.pregunta|truncatechars:120 }}</small><br>
                                {% endif %}

                                <div class="etapa-links">
                                    {% if etapa.contenido_adicional_archivo %}
                                        <a href="{{ etapa.contenido_adicional_archivo.url }}" download>
                                            üìÑ Descargar archivo
                                        </a>
                                    {% endif %}

                                    {% if etapa.contenido_adicional_url %}
                                        <a href="{{ etapa.contenido_adicional_url }}" target="_blank">
                                            üåê Ver contenido online
                                        </a>
                                    {% endif %}

                                    {% if not etapa.contenido_adicional_archivo and not etapa.contenido_adicional_url %}
                                        <small>Sin material adicional.</small>
                                    {% endif %}
                                </div>

                            </li>
                        {% endfor %}

                    </ul>
                {% else %}
                    <p>No hay material adicional configurado para este curso.</p>
                {% endif %}

            </div>

        </div>
    </div>

    <!-- OVERVIEW (√çndice flotante) -->
    <div class="overview" id="overview">
        <div class="overview-inner">

            <h2>{{ curso.nombre }}</h2>
            <p>Selecciona una secci√≥n:</p>

            <div class="overview__list">
                <div class="overview__card" data-target="presentacion">Presentaci√≥n del m√≥dulo</div>
                <div class="overview__card" data-target="indice">√çndice de contenidos</div>
                <div class="overview__card" data-target="pacientes">Sala de espera</div>
                <div class="overview__card" data-target="contenidos">Material adicional</div>
            </div>

        </div>
    </div>

    <!-- BOT√ìN PARA ABRIR √çNDICE -->
    <button id="btnIndex" class="btn btn--index">üß≠ Ver √≠ndice</button>

    <!-- NAVEGACI√ìN ENTRE SECCIONES -->
    <div class="footer-nav">
        <button id="btnPrev" class="btn btn--ghost">‚¨Ö Anterior</button>
        <button id="btnNext" class="btn btn--primary">Siguiente ‚û°</button>
    </div>

    <!-- JS -->
    <script src="{% static 'js/curso_detalle.js' %}"></script>

</body>

</html>
